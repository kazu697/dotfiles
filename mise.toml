[tasks.link]
description = "指定ディレクトリ配下をシンボリックリンク"
usage = '''
arg "<src>" help="リンク元ディレクトリ（例: config/.claude）"
arg "<dest>" help="リンク先ディレクトリ（例: ~/.claude）"
'''
run = '''
#!/usr/bin/env bash
set -e
SRC="${usage_src}"
DEST="${usage_dest}"
DOTFILES_DIR="$(pwd)"

mkdir -p "$DEST"
for item in "$DOTFILES_DIR/$SRC"/*; do
  ln -fns "$item" "$DEST/$(basename "$item")"
done
echo "Linked $SRC -> $DEST"
'''

[tasks.setup]
description = "dotfilesをホームディレクトリにシンボリックリンク"
depends = ["setup:config", "setup:home"]

[tasks."setup:config"]
description = ".config/** -> ~/.config/**"
run = '''
#!/usr/bin/env bash
set -e
DOTFILES_DIR="$(pwd)"

mkdir -p ~/.config
for item in "$DOTFILES_DIR/.config"/*; do
  ln -fns "$item" ~/.config/"$(basename "$item")"
done
echo "Linked .config/** -> ~/.config/**"
'''

[tasks."setup:home"]
description = "home/** -> ~/**"
run = '''
#!/usr/bin/env bash
set -e
DOTFILES_DIR="$(pwd)"

for item in "$DOTFILES_DIR/home"/* "$DOTFILES_DIR/home"/.*; do
  [ -e "$item" ] || continue
  name="$(basename "$item")"
  [ "$name" = "." ] || [ "$name" = ".." ] && continue
  ln -fns "$item" ~/"$name"
done
echo "Linked home/** -> ~/**"
'''
